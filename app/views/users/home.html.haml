- breadcrumb :users_home
- content_for(:title, 'ホーム')

.date-container
  .date
  .weekday
.clock
.button_container.mx-auto.d-grid.gap-3.my-3
  -# 出勤ボタン
  .work-btn-group.d-flex.g-col-12.column-gap-3
    = link_to works_path(@user.id), method: :post, class: "btn btn-primary flex-grow-1 btn-lg #{'disabled' if current_user.working?}" do
      %i.bi.bi-box-arrow-in-right
      .text 出勤
    -# 退勤ボタン
    = link_to work_path(@latest_work.id), method: :patch, class: "btn btn-primary flex-grow-1 btn-lg #{'disabled' if current_user.taking_a_break? || !current_user.working?}" do
      %i.bi.bi-box-arrow-right
      .text 退勤
  .break-btn-group.d-flex.g-col-12
    - # 休憩開始ボタン
    - unless current_user.taking_a_break?
      = link_to breaks_path, class: "btn btn-secondary flex-grow-1 #{'disabled' unless current_user.working?}", method: :post do
        %i.bi.bi-cup-hot
        .text 休憩開始

    - # 休憩終了ボタン
    - if current_user.taking_a_break?
      = link_to break_path(@latest_break.id), method: :patch, class: "btn btn-secondary flex-grow-1 " do
        %i.bi.bi-cup-hot
        .text 休憩終了

%h3 今日の記録
%table
  %thead
    %tr
      %th 出勤時間
      %th 退勤時間
      %th 休憩時間
      %th 累計休憩時間
      %th 労働時間
      %th 残業時間
  %tbody
    - @works_today.each do |work|
      %tr
        %td= formatted_time_only(work.start_datetime) # 出勤時間
        %td
          -if work.end_datetime # 退勤時
            = formatted_time_only(work.end_datetime)
          -else
            ="出勤中"

        %td
          - if work.breaks.any?
            - work.breaks.each do |break_record|
              %div
                = formatted_time_only(break_record.start_datetime) # 休憩開始時間
                - if break_record.end_datetime.present?
                  = " - " + formatted_time_only(break_record.end_datetime) # 休憩終了時間がある場合
                - else
                  = "-休憩中" # 休憩がまだ終了していない場合
          - else
            = "" # 休憩がない場合の表示
        %td= minutes_to_hours_and_minutes(work.total_break_time_in_minutes)
        %td= minutes_to_hours_and_minutes(work.total_work_time_in_minutes)
        %td= minutes_to_hours_and_minutes(work.total_overtime_in_minutes)