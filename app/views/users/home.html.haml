- breadcrumb :users_home
- content_for(:title, 'ホーム')

.clock
.date-container
  .date
  .weekday
.button_container.mx-auto.d-grid.gap-3.py-3
  -# 出勤ボタン
  .work-btn-group.d-flex.g-col-12.column-gap-3
    = link_to user_works_path(@user), method: :post, class: "btn btn-primary flex-grow-1 btn-lg #{'disabled' if current_user.working?}" do
      %i.bi.bi-box-arrow-in-right
      .text 出勤
    -# 退勤ボタン
    = link_to user_work_path(@user, @latest_work&.id || '#'), method: :patch, class: "btn btn-primary flex-grow-1 btn-lg #{'disabled' if current_user.taking_a_break? || !current_user.working?}" do
      %i.bi.bi-box-arrow-right
      .text 退勤
  .break-btn-group.d-flex.g-col-12
    - # 休憩開始ボタン
    - unless current_user.taking_a_break?
      = link_to user_breaks_path(@user), class: "btn btn-secondary flex-grow-1 #{'disabled' unless current_user.working?}", method: :post do
        %i.bi.bi-cup-hot
        .text 休憩開始

    - # 休憩終了ボタン
    - if current_user.taking_a_break?
      = link_to user_break_path(@user, @latest_break&.id || '#'), method: :patch, class: "btn btn-secondary flex-grow-1 " do
        %i.bi.bi-cup-hot
        .text 休憩終了

- if @latest_work.present?
  %table.table.my-4
    %thead
      %tr
        %th.text-primary-emphasis 出勤時間
        %th.text-primary-emphasis 退勤時間
        %th.text-primary-emphasis 休憩開始時間
        %th.text-primary-emphasis 休憩終了時間
        %th.text-primary-emphasis
    %tbody.table-group-divider
      - rowspan_value = @breaks.size.nonzero? || 1 # 休憩が存在する場合はその数、ない場合は1

      %tr.align-middle
        %td.text-primary-emphasis{ rowspan: rowspan_value }= formatted_time_only(@latest_work.start_datetime) # 出勤時間
        %td.text-primary-emphasis{ rowspan: rowspan_value }=@latest_work.end_datetime.present? ? formatted_time_only(@latest_work.end_datetime) : "-" # 退勤時間

        - if @breaks.any? # 休憩が存在する場合の処理
          - first_break = @breaks.first # 最初の休憩データを取得
          %td.text-dark= formatted_time_only(first_break.start_datetime) || "-" # 最初の休憩開始時間
          %td.text-dark= formatted_time_only(first_break.end_datetime) || "-" # 最初の休憩終了時間
        - else # 休憩がない場合の処理
          %td -
          %td -
        %td.text-center.text-primary-emphasis{ rowspan: rowspan_value }= link_to '詳細', user_work_path(@user, @latest_work), class: "btn btn-primary btn-sm" # 詳細ボタン

      - # 最初の休憩以外のデータをループ処理して出力
      - @breaks.drop(1).each do |break_time| # 最初の休憩（index 0）はスキップ
        %tr.align-middle
          %td.text-dark= formatted_time_only(break_time.start_datetime) || "-" # 休憩開始時間
          %td.text-dark= formatted_time_only(break_time.end_datetime) || "-" # 休憩終了時間
